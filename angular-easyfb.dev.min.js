/*! angular-easyfb
version: 0.1.0
build date: 2013-09-16
author: Robin Fan
https://github.com/pc035860/angular-easyfb.git */
angular.module("ezfb",[]).provider("$FB",function(){function a(b,c){if(0!==c.length){var d=c.shift();b[d]||(b[d]={}),a(b,c)}}function b(a,b){return angular.isObject(b)?(angular.extend(a,b),void 0):angular.copy(a)}function c(a,b,c){return function(){return a.apply(b,c)}}var d={api:[1,2,3],ui:1,getLoginStatus:0,login:0,logout:0,"Event.subscribe":1,"Event.unsubscribe":-1,"XFBML.parse":-1},e={status:!0,cookie:!0,xfbml:!0};return{setInitParams:function(a){b(e,a)},getInitParams:function(){return b(e)},$get:["$window","$q","$document","$parse","$rootScope",function(b,f,g,h,i){var j,k;if(!e.appId)throw new Error("appId required.");return g[0].getElementById("fb-root")||g.find("body").append('<div id="fb-root"></div>'),j=f.defer(),function(a){var b,c="facebook-jssdk",d=a.getElementsByTagName("script")[0];a.getElementById(c)||(b=a.createElement("script"),b.id=c,b.async=!0,b.src="//connect.facebook.net/en_US/all.js",d.parentNode.insertBefore(b,d))}(g[0]),b.fbAsyncInit=function(){b.FB.init(e),k.$$ready=!0,i.$apply(function(){j.resolve()})},k={$$ready:!1},angular.forEach(d,function(d,e){a(k,e.split(/\./));var g=h(e),l=g.assign;l(k,function(){var a=Array.prototype.slice.call(arguments),h=c(function(a){var c=f.defer(),h=function(b){for(var d=angular.isFunction(a[b])?a[b]:angular.noop,e=function(){var a=Array.prototype.slice.call(arguments);i.$$phase?(d.apply(null,a),c.resolve.apply(c,a)):i.$apply(function(){d.apply(null,a),c.resolve.apply(c,a)})};a.length<=b;)a.push(null);a[b]=e};if(angular.isNumber(d))h(d);else if(angular.isArray(d)){var j,k;for(j=0;j<d.length;j++)if(k=d[j],a.length==k||a.length==k+1&&angular.isFunction(a[k])){h(k);break}}var l=g(b.FB);if(!l)throw new Error("Facebook API `FB."+e+"` doesn't exist.");return l.apply(b.FB,a),c.promise},null,[a]);return j.promise.then(h)})}),k}]}}).directive("ezfbXfbml",["$FB","$parse","$compile","$timeout",function(a,b,c,d){return{restrict:"EAC",compile:function(e){var f=e.html();return function(e,g,h){var i=!0,j=h.onrender||"",k=function(){i&&(e.$eval(j),i=!1)},l="xfbml.render";j&&(a.Event.subscribe(l,k),g.bind("$destroy",function(){a.Event.unsubscribe(l,k),g.unbind("$destroy")})),a.XFBML.parse(g[0]);var m=b(h.ezfbXfbml).assign;e.$watch(h.ezfbXfbml,function(b){b&&(i=!0,g.html(f),c(g.contents())(e),d(function(){a.XFBML.parse(g[0])}),(m||angular.noop)(e,!1))},!0)}}}}]);