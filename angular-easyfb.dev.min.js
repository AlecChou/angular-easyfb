/*! angular-easyfb
version: 0.2.3
build date: 2014-02-22
author: Robin Fan
https://github.com/pc035860/angular-easyfb.git */
!function(a){a.provider("$FB",function(){function a(b,c){if(0!==c.length){var d=c.shift();b[d]||(b[d]={}),a(b,c)}}function b(a,b){return angular.isObject(b)?(angular.extend(a,b),void 0):angular.copy(a)}function c(a,b,c){return function(){return a.apply(b,c)}}var d=-1,e={api:[1,2,3],ui:1,getAuthResponse:d,getLoginStatus:0,login:0,logout:0,"Event.subscribe":1,"Event.unsubscribe":1,"XFBML.parse":1,"Canvas.Prefetcher.addStaticResource":d,"Canvas.Prefetcher.setCollectionMode":d,"Canvas.hideFlashElement":d,"Canvas.scrollTo":d,"Canvas.setAutoGrow":d,"Canvas.setDoneLoading":0,"Canvas.setSize":d,"Canvas.setUrlHandler":0,"Canvas.showFlashElement":d,"Canvas.startTimer":d,"Canvas.stopTimer":0},f="en_US",g={status:!0,cookie:!0,xfbml:!0},h=["$window","$document","$fbAsyncInit","$fbLocale",function(a,b,c,d){!function(a){var b,c="facebook-jssdk",e=a.getElementsByTagName("script")[0];a.getElementById(c)||(b=a.createElement("script"),b.id=c,b.async=!0,b.src="//connect.facebook.net/"+d+"/all.js",e.parentNode.insertBefore(b,e))}(b[0]),a.fbAsyncInit=c}],i=h,j=["$window","$fbInitParams",function(a,b){a.FB.init(b)}],k=j;return{setInitParams:function(a){b(g,a)},getInitParams:function(){return b(g)},setLocale:function(a){f=a},getLocale:function(){return f},setLoadSDKFunction:function(a){if(!angular.isArray(a)&&!angular.isFunction(a))throw new Error("Init function type error.");i=a},getLoadSDKFunction:function(){return i},setInitFunction:function(a){if(!angular.isArray(a)&&!angular.isFunction(a))throw new Error("Init function type error.");k=a},getInitFunction:function(){return k},$get:["$window","$q","$document","$parse","$rootScope","$injector",function(h,l,m,n,o,p){var q,r,s,t,u;return s={},t=l.defer(),(g.appId||k!==j)&&t.resolve(),q=l.defer(),m[0].getElementById("fb-root")||m.find("body").append('<div id="fb-root"></div>'),u=function(){t.promise.then(function(){p.invoke(k,null,{$fbInitParams:g}),r.$$ready=!0,q.resolve()})},p.invoke(i,null,{$fbAsyncInit:u,$fbLocale:f}),r={$$ready:!1,init:function(a){b(g,a),t.resolve()}},angular.forEach(e,function(b,e){a(r,e.split(/\./));var f=n(e),g=f.assign;g(r,function(){var a=c(function(a){var c,g;if(c=l.defer(),g=function(b){var d,f;for(d=angular.isFunction(a[b])?a[b]:angular.noop,f=function(){var a=Array.prototype.slice.call(arguments);o.$$phase?(d.apply(null,a),c.resolve.apply(c,a)):o.$apply(function(){d.apply(null,a),c.resolve.apply(c,a)})};a.length<=b;)a.push(null);var g;if("Event.subscribe"===e)g=a[0],angular.isUndefined(s[g])&&(s[g]=[]),s[g].push({original:d,wrapped:f});else if("Event.unsubscribe"===e&&(g=a[0],angular.isArray(s[g]))){var h,i,j=s[g].length;for(h=0;j>h;h++)if(i=s[g][h],i.original===d){f=i.wrapped,s[g].splice(h,1);break}}a[b]=f},b!==d)if(angular.isNumber(b))g(b);else if(angular.isArray(b)){var i,j;for(i=0;i<b.length;i++)if(j=b[i],a.length==j||a.length==j+1&&angular.isFunction(a[j])){g(j);break}}var k=f(h.FB);if(!k)throw new Error("Facebook API `FB."+e+"` doesn't exist.");return k.apply(h.FB,a),c.promise},null,[Array.prototype.slice.call(arguments)]);if("getAuthResponse"===e){if(angular.isUndefined(h.FB))throw new Error("`FB` is not ready.");return h.FB.getAuthResponse()}return b!==d?q.promise.then(a):(q.promise.then(a),void 0)})}),r}]}}).directive("ezfbXfbml",["$FB","$parse","$compile","$timeout",function(a,b,c,d){return{restrict:"EAC",controller:function(){},compile:function(e){var f=e.html();return function(e,g,h){var i=!0,j=h.onrender,k=function(){i&&(j&&e.$eval(j),i=!1)};a.XFBML.parse(g[0],k);var l=b(h.ezfbXfbml).assign;e.$watch(h.ezfbXfbml,function(b){b&&(i=!0,g.html(f),c(g.contents())(e),d(function(){a.XFBML.parse(g[0],k)}),(l||angular.noop)(e,!1))},!0)}}}}]);var b=function(b){var c="ezfb-social-plugin-wrap",d="display: inline-block; width: 0; height: 0; overflow: hidden;",e=function(a){var b='<span class="'+c+'" style="'+d+'">';return a.wrap(b).parent()},f=function(a){return a.parent().hasClass(c)},g=function(a){var b=a.parent();return b.after(a).remove(),a};a.directive(b,["$FB",function(a){return{restrict:"EC",require:"?^ezfbXfbml",link:function(b,c,d,h){if(!h){var i=!0,j=d.onrender,k=function(){i&&(j&&b.$eval(j),i=!1,g(c))};c.bind("$destroy",function(){f(c)&&g(c)}),a.XFBML.parse(e(c)[0],k)}}}}])};angular.forEach(["fbLike","fbShareButton","fbSend","fbPost","fbFollow","fbComments","fbActivity","fbRecommendations","fbRecommendationsBar","fbLikeBox","fbFacepile"],b)}(angular.module("ezfb",[]));